 select 'MinLevel' ReportFrom,locationid, ItemID,Location,CategoryTypeName,SubCategoryTypeName,itemgroupName,itemname,barcodeno,MachineName,ManufactureName,packsize,ConsumeUnit,batchnumber,Expirydate, MinLevel,RecorderLevel,sum(InhandQty)InhandQty from (  SELECT slm.locationid, stn.ItemID, Location ,cat.CategoryTypeName,subcat.SubCategoryTypeName,itemcat.Name itemgroupName,  (select itemnamegroup from st_itemmaster_group where itemidgroup=sm.itemidgroup)  itemname,ifnull(snt.barcodeno,'')barcodeno,sm.MachineName,sm.ManufactureName,sm.packsize,snt.minorunit ConsumeUnit,  ifnull(snt.batchnumber,'')batchnumber,ifnull(DATE_FORMAT(snt.expirydate,'%d-%b-%y'),'') Expirydate,MinLevel,RecorderLevel,ifnull((`InitialCount` - `ReleasedCount`-pendingqty),0) InhandQty   FROM `st_mappingitemmaster` stn  INNER JOIN st_nmsalesdetails sn	ON stn.ItemId=sn.itemid  INNER JOIN `st_locationmaster` slm ON stn.locationid=slm.locationid  INNER JOIN st_itemmaster sm ON sm.itemid=stn.itemid  INNER JOIN st_categorytypemaster cat ON cat.CategoryTypeID=sm.CategoryTypeID   INNER JOIN st_subcategorytypemaster subcat ON subcat.SubCategoryTypeID=sm.SubCategoryTypeID   INNER JOIN st_subcategorymaster itemcat ON itemcat.SubCategoryID=sm.SubCategoryID    inner join st_nmstock snt ON snt.stockid = sn.stockid  and snt.locationid=stn.locationid and snt.ispost=1 ) tb GROUP BY locationid,ItemID HAVING SUM(InhandQty) <= MinLevel order by location,itemname