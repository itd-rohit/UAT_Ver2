 SELECT Location ,cat.CategoryTypeName,subcat.SubCategoryTypeName,itemcat.Name itemgroupName,  stn.itemname,stn.barcodeno,sm.MachineName,stn.minorunit ConsumeUnit,  stn.batchnumber,DATE_FORMAT(stn.expirydate,'%d-%b-%y') Expirydate,(`InitialCount` - `ReleasedCount`-pendingqty) InhandQty,ifnull(sm.expdatecutoff,0)expdatecutoff    FROM `st_nmstock` stn  INNER JOIN `st_locationmaster` slm ON stn.locationid=slm.locationid  INNER JOIN st_itemmaster sm ON sm.itemid=stn.itemid  INNER JOIN st_categorytypemaster cat ON cat.CategoryTypeID=sm.CategoryTypeID   INNER JOIN st_subcategorytypemaster subcat ON subcat.SubCategoryTypeID=sm.SubCategoryTypeID   INNER JOIN st_subcategorymaster itemcat ON itemcat.SubCategoryID=sm.SubCategoryID    WHERE stn.ispost=1   and (`InitialCount` - `ReleasedCount`-pendingqty) >0  AND stn.expirydate >=@FromDate   AND stn.expirydate<=@ToDate  order by stn.expirydate